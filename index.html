<html>
  <head>
    <title>Express HTML</title>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"
      type="text/javascript"
    ></script>
    <script>
      // Called after form input is processed
      function startConnect() {
        // Generate a random client ID
        clientID = 'clientID-' + parseInt(Math.random() * 100);

        // Fetch the hostname/IP address and port number from the form
        host = document.getElementById('host').value;
        port = document.getElementById('port').value;

        // Print output for the user in the messages div
        document.getElementById('messages').innerHTML +=
          '<span>Connecting to: ' + host + ' on port: ' + port + '</span><br/>';
        document.getElementById('messages').innerHTML +=
          '<span>Using the following client value: ' + clientID + '</span><br/>';

        // Initialize new Paho client connection
        client = new Paho.MQTT.Client(host, Number(port), clientID);

        // Set callback handlers
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;

        // Connect the client, if successful, call onConnect function
        client.connect({
          onSuccess: onConnect
        });
      }

      // Called when the client connects
      function onConnect() {
        // Fetch the MQTT topic from the form
        topic = document.getElementById('topic').value;

        // Print output for the user in the messages div
        document.getElementById('messages').innerHTML +=
          '<span>Subscribing to: ' + topic + '</span><br/>';

        // Subscribe to the requested topic
        client.subscribe(topic);
      }

      // Called when the client loses its connection
      function onConnectionLost(responseObject) {
        console.log('onConnectionLost: Connection Lost');
        if (responseObject.errorCode !== 0) {
          console.log('onConnectionLost: ' + responseObject.errorMessage);
        }
      }

      // Called when a message arrives
      function onMessageArrived(message) {
        console.log('onMessageArrived: ' + message.payloadString);
        document.getElementById('messages').innerHTML +=
          '<span>Topic: ' +
          message.destinationName +
          '  | ' +
          message.payloadString +
          '</span><br/>';
        updateScroll(); // Scroll to bottom of window
      }

      // Called when the disconnection button is pressed
      function startDisconnect() {
        client.disconnect();
        document.getElementById('messages').innerHTML += '<span>Disconnected</span><br/>';
        updateScroll(); // Scroll to bottom of window
      }

      // Updates #messages div to auto-scroll
      function updateScroll() {
        var element = document.getElementById('messages');
        element.scrollTop = element.scrollHeight;
      }
    </script>
    <!-- <script>
      // Create a client instance
      client = new Paho.MQTT.Client(location.hostname, Number(location.port), 'clientId');

      // set callback handlers
      client.onConnectionLost = onConnectionLost;
      client.onMessageArrived = onMessageArrived;

      // connect the client
      client.connect({ onSuccess: onConnect });

      // called when the client connects
      function onConnect() {
        // Once a connection has been made, make a subscription and send a message.
        console.log('onConnect');
        client.subscribe('World');
        message = new Paho.MQTT.Message('Hello');
        message.destinationName = 'World';
        client.send(message);
      }

      // called when the client loses its connection
      function onConnectionLost(responseObject) {
        if (responseObject.errorCode !== 0) {
          console.log('onConnectionLost:' + responseObject.errorMessage);
        }
      }

      // called when a message arrives
      function onMessageArrived(message) {
        console.log('onMessageArrived:' + message.payloadString);
      }
    </script>
    <script src="http://localhost/socket.io/socket.io.js"></script>
    <script>
      var chat = io.connect('http://localhost/chat'),
        news = io.connect('http://localhost/news');

      chat.on('connect', function(data) {
        console.log(data);
        chat.emit('hi!');
      });

      news.on('news', function() {
        console.log(data);
        news.emit('woot');
      });
      function sendMessage() {
        news.emit('news', {
          text:
            document.getElementById('Username').value +
            ': ' +
            document.getElementById('Content').value
        });
      }
    </script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css"
    />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  </head>

  <body>
    <div style="margin:100px;">
      <nav class="navbar navbar-inverse navbar-static-top">
        <div class="container">
          <div class="wrapper">
            <h1>mqtt-demo</h1>
            <form id="connection-information-form">
              <b>Hostname or IP Address:</b>
              <input id="host" type="text" name="host" value="test.mosquitto.org" /><br />
              <b>Port:</b>
              <input id="port" type="text" name="port" value="8080" /><br />
              <b>Topic:</b>
              <input id="topic" type="text" name="topic" value="#" /><br /><br />
              <input type="button" onclick="startConnect()" value="Connect" />
              <input type="button" onclick="startDisconnect()" value="Disconnect" />
            </form>
            <div id="messages"></div>
          </div>
          <br />

          <a class="navbar-brand" href="/">Express HTML</a>
          <ul class="nav navbar-nav">
            <li class="active">
              <a href="/">Home</a>
            </li>
            <li>
              <a href="/about">About</a>
            </li>
            <li>
              <a href="/sitemap">Sitemap</a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="jumbotron" style="padding:40px;">
        <h1>Hello, world!</h1>
        <p>
          This is a simple hero unit, a simple jumbotron-style component for calling extra attention
          to featured content or information.
        </p>
        <p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a></p>
      </div>
    </div>
  </body>
</html>
